<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Professional audio tagging services for producers and creators">
    <title>{% block title %}TaggedByBelle{% endblock %}</title>
  
  
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', path='images/favicon.svg') }}">
  <link rel="alternate icon" href="{{ url_for('static', path='images/favicon.svg') }}">
  
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  
  <link rel="stylesheet" href="{{ url_for('static', path='css/main.css') }}">
  
  
  {% block extra_css %}{% endblock %}
  
    <style>
    /* ============================================
       NAVIGATION
       ============================================ */
    .navbar {
      position: sticky;
      top: 0;
      z-index: var(--z-sticky);
      backdrop-filter: saturate(180%) blur(20px);
      background: rgba(10, 14, 23, 0.8);
      border-bottom: 1px solid var(--border-subtle);
      transition: all var(--transition-base);
    }
    
    .navbar-inner {
      display: flex;
      align-items: center;
      gap: var(--space-6);
      height: 72px;
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 var(--space-6);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      font-weight: 900;
      font-size: var(--text-lg);
      color: var(--text-primary);
      text-decoration: none;
      margin-right: auto;
      transition: all var(--transition-fast);
    }
    
    .brand:hover {
      color: var(--brand);
    }
    
    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--brand) 0%, #b8d633 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: var(--text-inverse);
      box-shadow: 0 0 20px rgba(226, 251, 82, 0.3);
    }
    
    .nav-links {
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    
    .nav-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-4);
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      font-weight: 500;
      transition: all var(--transition-fast);
    }
    
    .nav-link:hover {
      color: var(--text-primary);
      background: var(--surface-hover);
    }
    
    .nav-link.active {
      color: var(--text-primary);
      background: var(--surface);
    }
    
    /* Dropdown */
    [data-dropdown] {
      position: relative;
    }
    
    [data-dropdown-menu] {
      position: absolute;
      right: 0;
      top: calc(100% + var(--space-2));
      min-width: 280px;
      background: var(--surface);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-2xl);
      padding: var(--space-2);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all var(--transition-base);
    }
    
    [data-dropdown].open [data-dropdown-menu] {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .dropdown-header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-subtle);
      margin-bottom: var(--space-2);
    }
    
    .dropdown-avatar {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-lg);
      object-fit: cover;
      background: var(--bg-elevated);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-tertiary);
      font-weight: 700;
      border: 2px solid var(--border-default);
    }
    
    .dropdown-user-info {
      flex: 1;
      min-width: 0;
    }
    
    .dropdown-username {
      font-weight: 700;
      color: var(--text-primary);
      font-size: var(--text-sm);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .dropdown-email {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3) var(--space-4);
      color: var(--text-primary);
      text-decoration: none;
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      transition: all var(--transition-fast);
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
    }
    
    .dropdown-item:hover {
      background: var(--surface-hover);
    }
    
    .dropdown-divider {
      height: 1px;
      background: var(--border-subtle);
      margin: var(--space-2) 0;
    }
    
    .avatar-button {
      position: relative;
      width: 36px;
      height: 36px;
      border-radius: var(--radius-full);
      border: 2px solid var(--border-default);
      overflow: hidden;
      cursor: pointer;
      transition: all var(--transition-fast);
      background: var(--bg-elevated);
    }
    
    .avatar-button:hover {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(226, 251, 82, 0.1);
    }
    
    .avatar-button img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .avatar-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--accent-purple) 0%, #6d28d9 100%);
      color: white;
      font-weight: 700;
      font-size: var(--text-sm);
    }
    
    .status-indicator {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 10px;
      height: 10px;
      background: var(--success);
      border: 2px solid var(--bg-primary);
      border-radius: var(--radius-full);
    }
    
    .earnings-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      background: var(--success-bg);
      color: var(--success);
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      font-weight: 600;
      margin-left: var(--space-2);
    }
    
    /* Mobile Menu */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
      }
      
      .navbar-inner {
        padding: 0 var(--space-4);
      }
      
      .brand {
        font-size: var(--text-base);
      }
    }
    
    /* ============================================
       MAIN LAYOUT
       ============================================ */
    main {
      min-height: calc(100vh - 72px);
      padding: var(--space-8) 0;
    }
    
    .page-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 var(--space-6);
    }
    
    /* ============================================
       FOOTER
       ============================================ */
    .footer {
      border-top: 1px solid var(--border-subtle);
      padding: var(--space-8) 0;
      margin-top: var(--space-16);
    }
    
    .footer-content {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 var(--space-6);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-6);
      flex-wrap: wrap;
    }
    
    .footer-text {
      color: var(--text-tertiary);
      font-size: var(--text-sm);
    }
    
    .footer-links {
      display: flex;
      gap: var(--space-6);
    }
    
    .footer-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: var(--text-sm);
      transition: color var(--transition-fast);
    }
    
    .footer-link:hover {
      color: var(--text-primary);
    }
    
    /* ============================================
       NOTIFICATIONS
       ============================================ */
    .notification-bell {
      position: relative;
      width: 40px;
      height: 40px;
      background: transparent;
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }
    
    .notification-bell:hover {
      background: var(--surface-hover);
      border-color: var(--border-strong);
      color: var(--text-primary);
    }
    
    .notification-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 18px;
      height: 18px;
      background: var(--error);
      color: white;
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 5px;
      box-shadow: 0 0 0 2px var(--bg-primary);
      animation: pulse-badge 2s ease-in-out infinite;
    }
    
    @keyframes pulse-badge {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }
    
    .notifications-menu {
      width: 420px;
      max-width: 90vw;
    }
    
    .notifications-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-subtle);
    }
    
    .notifications-title {
      font-size: var(--text-base);
      font-weight: 800;
      color: var(--text-primary);
      margin: 0;
    }
    
    .mark-all-read {
      background: none;
      border: none;
      color: var(--brand);
      font-size: var(--text-sm);
      font-weight: 600;
      cursor: pointer;
      padding: var(--space-2);
      transition: color var(--transition-fast);
    }
    
    .mark-all-read:hover {
      color: var(--brand-hover);
    }
    
    .notifications-list {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .notifications-list::-webkit-scrollbar {
      width: 6px;
    }
    
    .notifications-list::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }
    
    .notifications-list::-webkit-scrollbar-thumb {
      background: var(--border-default);
      border-radius: var(--radius-md);
    }
    
    .notification-item {
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-subtle);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      gap: var(--space-3);
      text-decoration: none;
      color: inherit;
    }
    
    .notification-item:hover {
      background: var(--surface-hover);
    }
    
    .notification-item:last-child {
      border-bottom: none;
    }
    
    .notification-item.unread {
      background: rgba(226, 251, 82, 0.05);
      border-left: 3px solid var(--brand);
    }
    
    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: var(--text-lg);
    }
    
    .notification-icon.order_placed,
    .notification-icon.delivered {
      background: rgba(59, 130, 246, 0.15);
      color: #60a5fa;
    }
    
    .notification-icon.revision_requested,
    .notification-icon.revision_approved {
      background: rgba(245, 158, 11, 0.15);
      color: #fbbf24;
    }
    
    .notification-icon.cancellation_requested,
    .notification-icon.cancellation_approved {
      background: rgba(239, 68, 68, 0.15);
      color: #f87171;
    }
    
    .notification-icon.extension_requested,
    .notification-icon.extension_approved {
      background: rgba(139, 92, 246, 0.15);
      color: #a78bfa;
    }
    
    .notification-icon.review_left {
      background: rgba(251, 191, 36, 0.15);
      color: #fbbf24;
    }
    
    .notification-icon.order_completed {
      background: rgba(16, 185, 129, 0.15);
      color: #34d399;
    }
    
    .notification-content {
      flex: 1;
      min-width: 0;
    }
    
    .notification-content-title {
      font-size: var(--text-sm);
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-1);
    }
    
    .notification-content-message {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: var(--leading-snug);
      margin-bottom: var(--space-1);
    }
    
    .notification-content-time {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
    }
    
    .notifications-loading,
    .notifications-empty {
      padding: var(--space-12);
      text-align: center;
      color: var(--text-tertiary);
    }
    
    .notifications-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-3);
    }
    
    .notifications-empty {
      font-size: var(--text-sm);
    }
    
    .notifications-footer {
      padding: var(--space-3);
      border-top: 1px solid var(--border-subtle);
      text-align: center;
    }
    
    .view-all-link {
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--brand);
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    
    .view-all-link:hover {
      color: var(--brand-hover);
    }
    
    /* ============================================
       MESSAGES INBOX
       ============================================ */
    .inbox-icon {
      position: relative;
      width: 40px;
      height: 40px;
      background: transparent;
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }
    
    .inbox-icon:hover {
      background: var(--surface-hover);
      border-color: var(--border-strong);
      color: var(--text-primary);
    }
    
    .inbox-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 18px;
      height: 18px;
      background: var(--brand);
      color: var(--bg-primary);
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 5px;
      box-shadow: 0 0 0 2px var(--bg-primary);
      animation: pulse-badge 2s ease-in-out infinite;
    }
    
    .messages-menu {
      width: 420px;
      max-width: 90vw;
    }
    
    .messages-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-subtle);
    }
    
    .messages-title {
      font-size: var(--text-base);
      font-weight: 800;
      color: var(--text-primary);
      margin: 0;
    }
    
    .messages-list {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .messages-list::-webkit-scrollbar {
      width: 6px;
    }
    
    .messages-list::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }
    
    .messages-list::-webkit-scrollbar-thumb {
      background: var(--border-default);
      border-radius: var(--radius-md);
    }
    
    .message-item {
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-subtle);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      gap: var(--space-3);
      text-decoration: none;
      color: inherit;
    }
    
    .message-item:hover {
      background: var(--surface-hover);
    }
    
    .message-item:last-child {
      border-bottom: none;
    }
    
    .message-item.unread {
      background: rgba(226, 251, 82, 0.05);
      border-left: 3px solid var(--brand);
    }
    
    .message-avatar-small {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--surface-hover);
      color: var(--text-secondary);
      font-weight: 700;
      font-size: var(--text-sm);
      overflow: hidden;
    }
    
    .message-avatar-small img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .message-content-small {
      flex: 1;
      min-width: 0;
    }
    
    .message-sender-name-wrapper {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-bottom: var(--space-1);
      flex-wrap: wrap;
    }
    
    .message-sender-name {
      font-size: var(--text-sm);
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .message-order-id {
      font-size: var(--text-xs);
      font-weight: 600;
      color: var(--text-tertiary);
      background: var(--surface-hover);
      padding: 2px 8px;
      border-radius: var(--radius-md);
    }
    
    .message-unread-badge {
      min-width: 20px;
      height: 20px;
      background: var(--brand);
      color: var(--bg-primary);
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 6px;
      line-height: 1;
      margin-left: auto;
    }
    
    .message-preview {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: var(--leading-snug);
      margin-bottom: var(--space-1);
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    .message-time-small {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
    }
    
    .messages-loading,
    .messages-empty {
      padding: var(--space-12);
      text-align: center;
      color: var(--text-tertiary);
    }
    
    .messages-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-3);
    }
    
    .messages-empty {
      font-size: var(--text-sm);
    }
    
    .messages-footer {
      padding: var(--space-3);
      border-top: 1px solid var(--border-subtle);
      text-align: center;
    }
    
    .notification-icon.order_auto_completed {
      background: rgba(16, 185, 129, 0.15);
      color: #34d399;
    }
    </style>
  </head>
  <body>
  
    <header class="navbar">
    <div class="navbar-inner">
      
      <a href="/" class="brand">
        <div class="brand-logo">TB</div>
        <span>TaggedByBelle</span>
      </a>
      
      
      <nav class="nav-links">
          {% if request.session.get('user_id') %}
          
          <a href="{{ '/myorders-admin' if request.session.get('is_admin') else '/myorders' }}" class="nav-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            Dashboard
          </a>
          
          {% if request.session.get('is_admin') %}
          <a href="/analytics" class="nav-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
            Analytics
          </a>
          {% endif %}
          
          
          <div data-dropdown id="messagesDropdown" style="position: relative;">
            <button data-dropdown-trigger class="inbox-icon" id="inboxIcon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                <polyline points="22,6 12,13 2,6"></polyline>
              </svg>
              <span class="inbox-badge" id="inboxBadge" style="display: none;">0</span>
            </button>
            
            <div data-dropdown-menu class="messages-menu">
              <div class="messages-header">
                <h3 class="messages-title">Messages</h3>
                <button onclick="markAllMessagesRead()" class="mark-all-read">Mark all read</button>
              </div>
              
              <div class="messages-list" id="messagesList">
                <div class="messages-loading">
                  <div class="spinner"></div>
                  <span>Loading...</span>
                </div>
              </div>
              
              <div class="messages-footer">
                <a href="#" class="view-all-link">View all messages</a>
              </div>
            </div>
          </div>
          
          
          <div data-dropdown id="notificationsDropdown" style="position: relative;">
            <button data-dropdown-trigger class="notification-bell" id="notificationBell">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
              </svg>
              <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            </button>
            
            <div data-dropdown-menu class="notifications-menu">
              <div class="notifications-header">
                <h3 class="notifications-title">Notifications</h3>
                <button onclick="markAllAsRead()" class="mark-all-read">Mark all read</button>
              </div>
              
              <div class="notifications-list" id="notificationsList">
                <div class="notifications-loading">
                  <div class="spinner"></div>
                  <span>Loading...</span>
                </div>
              </div>
              
              <div class="notifications-footer">
                <a href="#" class="view-all-link">View all notifications</a>
              </div>
            </div>
          </div>
          
          
          <div data-dropdown>
            <button data-dropdown-trigger class="avatar-button">
              {% if request.session.get('avatar_url') %}
                <img src="{{ request.session.get('avatar_url') }}" alt="{{ request.session.get('username') }}">
              {% else %}
                <div class="avatar-placeholder">{{ request.session.get('username', 'U')[0]|upper }}</div>
              {% endif %}
              <span class="status-indicator"></span>
            </button>
            
            {% if request.session.get('is_admin') %}
              <span class="earnings-badge">
                ‚Ç¨{{ '%.2f'|format(request.session.get('admin_month_earnings', 0.0)) }}
              </span>
            {% endif %}
            
            <div data-dropdown-menu>
              <div class="dropdown-header">
                {% if request.session.get('avatar_url') %}
                  <img src="{{ request.session.get('avatar_url') }}" alt="{{ request.session.get('username') }}" class="dropdown-avatar">
                {% else %}
                  <div class="dropdown-avatar">{{ request.session.get('username', 'U')[0]|upper }}</div>
                {% endif %}
                <div class="dropdown-user-info">
                  <div class="dropdown-username">{{ request.session.get('username') }}</div>
                  <div class="dropdown-email">{{ request.session.get('email', '') }}</div>
                </div>
              </div>
              
              <a href="/profile" class="dropdown-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Profile Settings
              </a>
              
              {% if request.session.get('is_admin') %}
              <a href="/packages" class="dropdown-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="9" y1="9" x2="15" y2="9"></line>
                  <line x1="9" y1="15" x2="15" y2="15"></line>
                </svg>
                Manage Packages
              </a>
              {% endif %}
              
              <div class="dropdown-divider"></div>
              
              <form method="post" action="/logout" style="margin: 0;">
                <button type="submit" class="dropdown-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                  </svg>
                  Log Out
                </button>
                </form>
              </div>
            </div>
          {% else %}
          
          <a href="/login" class="btn btn-ghost btn-sm">Log In</a>
          <a href="/signup" class="btn btn-primary btn-sm">Sign Up</a>
          {% endif %}
        </nav>
      </div>
    </header>
  
  
  <main>
      {% block content %}{% endblock %}
    </main>
  
  
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-text">
        ¬© 2025 TaggedByBelle. All rights reserved.
      </div>
      <div class="footer-links">
        <a href="#" class="footer-link">Terms</a>
        <a href="#" class="footer-link">Privacy</a>
        <a href="#" class="footer-link">Support</a>
      </div>
    </div>
  </footer>
  
  
  <script src="{{ url_for('static', path='js/main.js') }}"></script>
  
  
  {% if request.session.get('user_id') %}
    <script>
    // ============================================
    // NOTIFICATION SYSTEM
    // ============================================
    
    let notifications = [];
    
    // Notification icons mapping
    const notificationIcons = {
      'order_placed': 'üì¶',
      'delivered': '‚úÖ',
      'revision_requested': 'üîÑ',
      'revision_approved': '‚úì',
      'cancellation_requested': '‚ùå',
      'cancellation_approved': '‚úì',
      'extension_requested': '‚è∞',
      'extension_approved': '‚úì',
      'review_left': '‚≠ê',
      'order_completed': 'üéâ',
      'order_auto_completed': '‚è∞'
    };
    
    // Load notifications
    async function loadNotifications() {
      try {
        const response = await fetch('/notifications');
        const data = await response.json();
        notifications = data.notifications;
        renderNotifications();
      } catch (error) {
        console.error('Error loading notifications:', error);
      }
    }
    
    // Render notifications in dropdown
    function renderNotifications() {
      const notificationsList = document.getElementById('notificationsList');
      
      if (notifications.length === 0) {
        notificationsList.innerHTML = `
          <div class="notifications-empty">
            <div style="font-size: 3rem; margin-bottom: var(--space-4);">üîî</div>
            <div>No notifications yet</div>
          </div>
        `;
        return;
      }
      
      notificationsList.innerHTML = notifications.map(notif => `
        <a 
          href="/order/${notif.order_id}" 
          class="notification-item ${notif.is_read ? '' : 'unread'}"
          onclick="markAsRead(event, ${notif.id})"
        >
          <div class="notification-icon ${notif.type}">
            ${notificationIcons[notif.type] || 'üîî'}
          </div>
          <div class="notification-content">
            <div class="notification-content-title">${notif.title}</div>
            <div class="notification-content-message">${notif.message}</div>
            <div class="notification-content-time">${notif.time_ago}</div>
          </div>
        </a>
      `).join('');
    }
    
    // Update unread count badge
    async function updateUnreadCount() {
      try {
        const response = await fetch('/notifications/unread-count');
        const data = await response.json();
        const count = data.count;
        
        const badge = document.getElementById('notificationBadge');
        if (count > 0) {
          badge.textContent = count > 99 ? '99+' : count;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      } catch (error) {
        console.error('Error updating unread count:', error);
      }
    }
    
    // Mark notification as read
    async function markAsRead(event, notificationId) {
      try {
        await fetch(`/notifications/${notificationId}/mark-read`, {
          method: 'POST'
        });
        
        // Update UI immediately
        const notif = notifications.find(n => n.id === notificationId);
        if (notif) notif.is_read = true;
        
        updateUnreadCount();
      } catch (error) {
        console.error('Error marking notification as read:', error);
      }
    }
    
    // Mark all as read
    async function markAllAsRead() {
      try {
        await fetch('/notifications/mark-all-read', {
          method: 'POST'
        });
        
        // Update all notifications
        notifications.forEach(n => n.is_read = true);
        renderNotifications();
        updateUnreadCount();
      } catch (error) {
        console.error('Error marking all as read:', error);
      }
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateUnreadCount();
      
      // Listen for notification dropdown open
      const notificationsDropdown = document.getElementById('notificationsDropdown');
      const notificationBell = document.getElementById('notificationBell');
      
      if (notificationBell) {
        notificationBell.addEventListener('click', function() {
          loadNotifications();
        });
      }
    });
    
    // Auto-update unread count every 10 seconds
    setInterval(updateUnreadCount, 10000);
    
    // Expose functions globally
    window.markAsRead = markAsRead;
    window.markAllAsRead = markAllAsRead;
    
    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ============================================
    // MESSAGES INBOX SYSTEM
    // ============================================
    
    let messages = [];
    
    // Load messages
    async function loadMessages() {
      try {
        const response = await fetch('/messages/notifications');
        const data = await response.json();
        messages = data.messages;
        renderMessages();
      } catch (error) {
        console.error('Error loading messages:', error);
      }
    }
    
    // Render messages in dropdown
    function renderMessages() {
      const messagesList = document.getElementById('messagesList');
      
      if (messages.length === 0) {
        messagesList.innerHTML = `
          <div class="messages-empty">
            <div style="font-size: 3rem; margin-bottom: var(--space-4);">üí¨</div>
            <div>No messages</div>
          </div>
        `;
        return;
      }
      
      messagesList.innerHTML = messages.map(msg => {
        const avatarHTML = msg.sender_avatar 
          ? `<img src="/uploads/${msg.sender_avatar}" alt="${msg.sender_name}">`
          : `<div>${msg.sender_name[0].toUpperCase()}</div>`;
        
        // Show unread count badge only if there are unread messages
        const unreadBadge = msg.has_unread && msg.unread_count > 0
          ? `<span class="message-unread-badge">${msg.unread_count > 99 ? '99+' : msg.unread_count}</span>`
          : '';
        
        return `
          <a 
            href="/order/${msg.order_id}#chat" 
            class="message-item ${msg.has_unread ? 'unread' : ''}"
            onclick="markMessageAsRead(event, ${msg.order_id})"
          >
            <div class="message-avatar-small">${avatarHTML}</div>
            <div class="message-content-small">
              <div class="message-sender-name-wrapper">
                <span class="message-sender-name">${msg.sender_name}</span>
                <span class="message-order-id">Order #${msg.order_id}</span>
                ${unreadBadge}
              </div>
              <div class="message-preview">${escapeHtml(msg.message_text)}</div>
              <div class="message-time-small">${msg.time_ago}</div>
            </div>
          </a>
        `;
      }).join('');
    }
    
    // Update unread messages count badge
    async function updateUnreadMessagesCount() {
      try {
        const response = await fetch('/messages/unread-count');
        const data = await response.json();
        const count = data.count;
        
        const badge = document.getElementById('inboxBadge');
        if (count > 0) {
          badge.textContent = count > 99 ? '99+' : count;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      } catch (error) {
        console.error('Error updating unread messages count:', error);
      }
    }
    
    // Mark message as read (called when clicking message)
    async function markMessageAsRead(event, orderId) {
      try {
        // Messages will be marked as read when viewing the order page
        // Just reload messages to update the count after navigation
        // The order page will handle marking messages as read
        setTimeout(() => {
          loadMessages();
          updateUnreadMessagesCount();
        }, 1000);
      } catch (error) {
        console.error('Error marking message as read:', error);
      }
    }
    
    // Mark all messages as read
    async function markAllMessagesRead() {
      try {
        await fetch('/messages/mark-all-read', {
          method: 'POST'
        });
        
        // Reload messages to get updated counts
        await loadMessages();
        updateUnreadMessagesCount();
      } catch (error) {
        console.error('Error marking all messages as read:', error);
      }
    }
    
    // Initialize messages on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateUnreadMessagesCount();
      
      // Listen for inbox dropdown open - reload messages each time
      const inboxIcon = document.getElementById('inboxIcon');
      const messagesDropdown = document.getElementById('messagesDropdown');
      
      if (inboxIcon && messagesDropdown) {
        // Use event delegation to catch dropdown opens
        inboxIcon.addEventListener('click', function(e) {
          // Small delay to ensure dropdown is opening
          setTimeout(() => {
            loadMessages();
          }, 100);
        });
        
        // Also listen for dropdown menu visibility
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
              const menu = messagesDropdown.querySelector('[data-dropdown-menu]');
              if (menu && menu.classList.contains('show')) {
                loadMessages();
              }
            }
          });
        });
        
        observer.observe(messagesDropdown, {
          attributes: true,
          attributeFilter: ['class']
        });
      }
      });
    
    // Auto-update unread messages count every 10 seconds
    setInterval(updateUnreadMessagesCount, 10000);
    
    // Expose functions globally
    window.markMessageAsRead = markMessageAsRead;
    window.markAllMessagesRead = markAllMessagesRead;
    </script>
  {% endif %}
  
  
  {% block extra_js %}{% endblock %}
</body>
</html>
