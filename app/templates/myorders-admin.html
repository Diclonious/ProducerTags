{% extends "base.html" %}
{% block title %}All Orders{% endblock %}

{% block content %}
<h2>All Orders</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
   {% for order in orders %}
   <div class="card p-4 shadow rounded hover:shadow-lg transition">
       <h3>Order #{{ order.id }}</h3>
       <p><strong>User:</strong> {{ order.user.username }}</p>
       <p><strong>Details:</strong> {{ order.details or "N/A" }}</p>
       <p><strong>Tags:</strong> {{ order.tags | length }}</p>
       <p><strong>Due in:</strong> <span id="timer-{{ order.id }}">Calculating...</span></p>
       <a href="/order/{{ order.id }}" class="text-blue-500 hover:underline mt-2 block">View Details</a>

       <script>
           (function() {
               var countdownDate = new Date("{{ order.due_date.isoformat() }}").getTime();
               var timerId = "timer-{{ order.id }}";
               function updateTimer() {
                   var now = new Date().getTime();
                   var distance = countdownDate - now;
                   if (distance < 0) {
                       document.getElementById(timerId).innerHTML = "Order is due!";
                       clearInterval(interval);
                       return;
                   }
                   var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                   var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                   var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                   var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                   document.getElementById(timerId).innerHTML =
                       days + "d " + hours + "h " + minutes + "m " + seconds + "s";
               }
               updateTimer(); // initial call
               var interval = setInterval(updateTimer, 1000);
           })();
       </script>
   </div>
   {% else %}
   <p>No orders found.</p>
   {% endfor %}
</div>
{% endblock %}
